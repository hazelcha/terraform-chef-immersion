# terraform-chef-immersion
Terraform module for creating Chef training environment <br />
Deploying this stack will create the following:
- 1 chef server bootstrapped
- 1 chef organization called `hizzle-inc`
- 1 chef user called `chefadmin` and user keys
- n number of chef nodes
- `knife.rb` file

## Requirements
 - Terraform CLI version >= 0.13
 ```bash
 brew install hashicorp/tap/terraform
 ```
 Or check the installation [documentation](https://learn.hashicorp.com/tutorials/terraform/install-cli)
 
 - AWS Account
 
## How to use
### Pre-configurations

1. Configure AWS account credentials to be used with this module. <br />

.aws/config
```
[profile hazel-lab]
region = us-east-1
output = table
```
.aws/credentials
```
[hazel-lab]
aws_access_key_id = ****
aws_secret_access_key = ****
```
2. Generate SSH keys within the `terraform-chef-immersion/ssh-keys/` directory
```bash
ssh-keygen -t rsa -f chef-immersion -C "youremail@example.com"
chmod 400 ./chef-immersion
```
:warning: &nbsp; If you call the SSH keys something other than `chef-immersion` you must change it in the terraform module as well.

### Variables
1. Copy `terraform.tfvars.example` to `terraform.tfvars`
```bash
cp terraform.tfvars.example terraform.tfvars
```
2. Modify the values for at least all the required variables and save

### Deploy
1. Initialize Terraform
```bash
terraform init
```
2. Validate Terraform configuration
```bash
terraform validate
```
3. Apply Terraform configuration
```bash
terraform apply
```
4. Grab a cup of :coffee: &nbsp; while the chef server bootstraps. It will take ~5 minutes
5. Check the AWS instance system logs for the message `Your Chef server is ready!` or SSH directly onto the chef server and check `/chef-server-install.txt`
6. Download the `chefadmin` user private key from the chef server using scp. The command will have been output to STDOUT by the Terraform run.

### Outcome
Chef interaction requirements will be generated in the `chef-files` directory
- `knife.rb` config (generated by Terraform)
- `chefadmin.pem` (downloaded from the chef server)
- chef-immersion (private and public key should have been created by user previously)
